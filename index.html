<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#9D4EDD">
    <title>SENA - Sua Assistente Digital</title>
    
    <link rel="icon" type="image/png" href="https://i.imgur.com/5watJQF.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * { font-family: 'Poppins', sans-serif; }
        
        body {
            background: linear-gradient(180deg, #7B2CBF 0%, #C77DFF 100%);
            min-height: 100vh;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes wave {
            0%, 100% { transform: scaleY(0.5); }
            50% { transform: scaleY(1.2); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .float-animation { animation: float 3s ease-in-out infinite; }
        .fade-in { animation: fadeIn 0.5s ease-out; }
        .pulse-dot { animation: pulse 2s ease-in-out infinite; }
        .wave-bar { animation: wave 0.6s ease-in-out infinite; }
        .bounce-animation { animation: bounce 2s infinite; }
        .shake-animation { animation: shake 0.5s ease-in-out; }
        
        .chat-bubble {
            animation: fadeIn 0.3s ease-out;
            max-width: 80%;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #9D4EDD 0%, #E0AAFF 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .dark .glass {
            background: rgba(30, 30, 40, 0.95);
        }
        
        .message-user {
            background: linear-gradient(135deg, #9D4EDD 0%, #C77DFF 100%);
            color: white;
            border-radius: 20px 20px 5px 20px;
        }
        
        .message-bot {
            background: #F5F5F7;
            color: #1A1A1A;
            border-radius: 20px 20px 20px 5px;
        }
        
        .dark .message-bot {
            background: #2A2A3A;
            color: #FFFFFF;
        }
        
        .input-container {
            background: white;
            border-radius: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .dark .input-container {
            background: #2A2A3A;
            border: 1px solid #3A3A4A;
        }
        
        .avatar-3d {
            width: 200px;
            height: 200px;
            position: relative;
        }
        
        .wave-bg {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 150px;
            background: rgba(255, 255, 255, 0.1);
            clip-path: polygon(0 50%, 100% 30%, 100% 100%, 0% 100%);
        }
        
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { 
            background: rgba(157, 78, 221, 0.3); 
            border-radius: 10px; 
        }
        
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { 
            background: rgba(157, 78, 221, 0.5); 
        }
        
        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 12px 16px;
        }
        
        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #9D4EDD;
            animation: pulse 1.4s infinite;
        }
        
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        
        /* Novos estilos para bot√µes com gradiente roxo/rosa */
        .btn-gradient {
            background: linear-gradient(135deg, #9D4EDD 0%, #C77DFF 100%);
            color: white;
        }
        
        .btn-gradient:hover {
            background: linear-gradient(135deg, #7B2CBF 0%, #9D4EDD 100%);
        }
        
        .suggestion-btn {
            background: rgba(255, 255, 255, 0.9);
            color: #7B2CBF;
            border: 1px solid rgba(157, 78, 221, 0.2);
        }
        
        .suggestion-btn:hover {
            background: white;
            color: #9D4EDD;
            border-color: rgba(157, 78, 221, 0.4);
        }
        
        .dark .suggestion-btn {
            background: rgba(45, 45, 60, 0.9);
            color: #E0AAFF;
            border: 1px solid rgba(157, 78, 221, 0.3);
        }
        
        .dark .suggestion-btn:hover {
            background: rgba(60, 60, 80, 0.9);
            border-color: rgba(157, 78, 221, 0.5);
        }
        
        .menu-item {
            color: #1A1A1A;
        }
        
        .dark .menu-item {
            color: #FFFFFF;
        }
        
        .settings-modal {
            background: rgba(0, 0, 0, 0.5);
        }
        
        .settings-content {
            background: white;
            border-radius: 20px;
        }
        
        .dark .settings-content {
            background: #2A2A3A;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background: linear-gradient(135deg, #9D4EDD 0%, #C77DFF 100%);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        /* Assistive Touch Styles */
        .assistive-touch {
            position: fixed;
            right: 20px;
            bottom: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #9D4EDD 0%, #C77DFF 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 3px solid white;
        }
        
        .assistive-touch:hover {
            transform: scale(1.1);
        }
        
        .assistive-touch.active {
            transform: scale(1.2);
            background: linear-gradient(135deg, #7B2CBF 0%, #9D4EDD 100%);
        }
        
        .assistive-menu {
            position: fixed;
            right: 90px;
            bottom: 20px;
            background: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 999;
            transform: scale(0);
            transform-origin: right bottom;
            transition: transform 0.3s ease;
            min-width: 200px;
        }
        
        .dark .assistive-menu {
            background: #2A2A3A;
            color: white;
        }
        
        .assistive-menu.active {
            transform: scale(1);
        }
        
        .assistive-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 500;
        }
        
        .assistive-btn:hover {
            background: rgba(157, 78, 221, 0.1);
        }
        
        .dark .assistive-btn:hover {
            background: rgba(157, 78, 221, 0.2);
        }
        
        .assistive-btn:last-child {
            margin-bottom: 0;
        }
        
        .assistive-btn i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .high-contrast {
            filter: contrast(2) brightness(0.8);
        }
        
        .large-text * {
            font-size: 1.2em !important;
            line-height: 1.6 !important;
        }
        
        .text-to-speech-active {
            border: 3px solid #FF6B6B !important;
        }
        
        .screen-reader-text {
            position: absolute;
            left: -10000px;
            top: auto;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        
        .focus-highlight:focus {
            outline: 3px solid #FF6B6B !important;
            outline-offset: 2px;
        }
        
        .voice-feedback {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            z-index: 1001;
            font-size: 14px;
        }
    </style>
</head>
<body>

<!-- Screen Reader Only Text -->
<div class="screen-reader-text" id="screenReaderAnnouncement"></div>

<!-- Voice Feedback -->
<div id="voiceFeedback" class="voice-feedback hidden"></div>

<!-- Splash Screen / Welcome -->
<div id="splashScreen" class="fixed inset-0 flex flex-col items-center justify-center z-50 px-6">
    <div class="text-center fade-in">
        <!-- Avatar 3D - Nova Logo -->
        <div class="avatar-3d mx-auto mb-8 float-animation">
            <img src="https://i.imgur.com/5xKCbP5.png" alt="Sena Logo" class="w-full h-full object-contain drop-shadow-2xl rounded-3xl">
        </div>
        
        <!-- Title -->
        <h1 class="text-5xl font-bold text-white mb-3">SENA</h1>
        <p class="text-xl text-white/90 mb-2">Welcome Back!</p>
        <p class="text-sm text-white/70 mb-12 max-w-xs mx-auto">
            Sua assistente digital com alma gentil
        </p>
        
        <!-- Get Started Button -->
        <button onclick="startChat()" class="btn-gradient px-10 py-4 rounded-full text-lg font-semibold hover:scale-105 transition-transform shadow-xl focus-highlight">
            Get Started üå∏
        </button>
        
        <!-- Wave Background -->
        <div class="wave-bg"></div>
    </div>
</div>

<!-- Main Chat Interface -->
<div id="chatInterface" class="hidden fixed inset-0 flex flex-col">
    <!-- Header Simples - Apenas Logo e Nome -->
    <div class="glass px-6 py-4 flex items-center justify-center border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center gap-3">
            <img src="https://i.imgur.com/5watJQF.png" alt="Sena" class="w-12 h-12 rounded-full">
            <div>
                <h2 class="font-bold text-gray-900 dark:text-white text-xl">Sena</h2>
                <div class="flex items-center gap-1">
                    <div class="w-2 h-2 bg-green-500 rounded-full pulse-dot"></div>
                    <span class="text-xs text-gray-600 dark:text-gray-400">Online</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Messages Container -->
    <div id="messagesContainer" class="flex-1 overflow-y-auto px-6 py-6 space-y-4 custom-scrollbar">
        <!-- Messages will be inserted here -->
    </div>
    
    <!-- Disclaimer -->
    <div class="px-6 py-2">
        <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-2xl px-4 py-2 flex items-start gap-2">
            <svg class="w-4 h-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
            </svg>
            <p class="text-xs text-yellow-800 dark:text-yellow-200">
                <strong>Aviso:</strong> Sena pode cometer erros. Verifique informa√ß√µes importantes.
            </p>
        </div>
    </div>
    
    <!-- Voice Indicator -->
    <div id="voiceIndicator" class="hidden px-6 py-3">
        <div class="glass rounded-3xl px-6 py-4 flex items-center justify-center gap-3 border border-purple-200 dark:border-purple-800">
            <div class="flex gap-1">
                <div class="w-1 h-8 bg-pink-500 rounded-full wave-bar"></div>
                <div class="w-1 h-8 bg-pink-500 rounded-full wave-bar" style="animation-delay: 0.1s;"></div>
                <div class="w-1 h-8 bg-pink-500 rounded-full wave-bar" style="animation-delay: 0.2s;"></div>
                <div class="w-1 h-8 bg-pink-500 rounded-full wave-bar" style="animation-delay: 0.3s;"></div>
            </div>
            <span class="text-pink-600 dark:text-pink-400 font-medium">Listening...</span>
        </div>
    </div>
    
    <!-- Footer com controles -->
    <div class="glass px-6 py-3 border-t border-gray-200 dark:border-gray-700">
        <!-- Bot√µes de a√ß√£o -->
        <div class="flex items-center justify-center gap-2 mb-3">
            <button onclick="showMenu()" class="p-2 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg transition-colors focus-highlight" title="Menu">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
            <button onclick="toggleDarkMode()" class="p-2 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg transition-colors focus-highlight" title="Tema">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
            </button>
            <button onclick="clearChat()" class="p-2 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg transition-colors focus-highlight" title="Nova conversa">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
            </button>
            <button onclick="showSettings()" class="p-2 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg transition-colors focus-highlight" title="Configura√ß√µes">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </button>
        </div>
        
        <!-- Input Area -->
        <form id="messageForm" class="input-container flex items-center gap-3 px-4 py-3">
            <button type="button" onclick="toggleVoice()" class="p-3 bg-purple-100 dark:bg-purple-900/30 rounded-full hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors focus-highlight">
                <svg id="micIcon" class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                </svg>
            </button>
            
            <input 
                type="text" 
                id="messageInput" 
                placeholder="Type a message..."
                class="flex-1 bg-transparent outline-none text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus-highlight"
            />
            
            <button type="submit" class="p-3 btn-gradient rounded-full hover:scale-105 transition-transform focus-highlight">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
            </button>
        </form>
    </div>
</div>

<!-- Assistive Touch -->
<div id="assistiveTouch" class="assistive-touch bounce-animation" onclick="toggleAssistiveMenu()" aria-label="Menu de Acessibilidade" role="button" tabindex="0">
    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
    </svg>
</div>

<!-- Assistive Menu -->
<div id="assistiveMenu" class="assistive-menu" role="menu" aria-label="Op√ß√µes de Acessibilidade">
    <div class="assistive-btn" onclick="toggleTextToSpeech()" role="menuitem" tabindex="0">
        <i>üîä</i>
        <span>Ler Tela</span>
    </div>
    <div class="assistive-btn" onclick="increaseFontSize()" role="menuitem" tabindex="0">
        <i>üîç</i>
        <span>Aumentar Texto</span>
    </div>
    <div class="assistive-btn" onclick="decreaseFontSize()" role="menuitem" tabindex="0">
        <i>üìê</i>
        <span>Diminuir Texto</span>
    </div>
    <div class="assistive-btn" onclick="toggleHighContrast()" role="menuitem" tabindex="0">
        <i>üåì</i>
        <span>Alto Contraste</span>
    </div>
    <div class="assistive-btn" onclick="speakCurrentTime()" role="menuitem" tabindex="0">
        <i>‚è∞</i>
        <span>Que Horas S√£o?</span>
    </div>
    <div class="assistive-btn" onclick="speakHelp()" role="menuitem" tabindex="0">
        <i>‚ùì</i>
        <span>Ajuda</span>
    </div>
    <div class="assistive-btn" onclick="emergencyCall()" role="menuitem" tabindex="0">
        <i>üö®</i>
        <span>Emerg√™ncia</span>
    </div>
</div>

<!-- Menu Lateral -->
<div id="sideMenu" class="hidden fixed inset-0 z-50 bg-black/50" onclick="hideMenu()">
    <div class="glass w-80 h-full p-6 space-y-6 overflow-y-auto custom-scrollbar" onclick="event.stopPropagation()">
        <div class="flex items-center justify-between">
            <h3 class="text-xl font-bold menu-item">Menu</h3>
            <button onclick="hideMenu()" class="p-2 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg focus-highlight">
                <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <!-- Chat Section -->
        <div class="space-y-2">
            <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider px-3">Chat</p>
            <button onclick="clearChat()" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                <span class="menu-item">Nova conversa</span>
            </button>
            
            <button onclick="changeLanguage()" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
                </svg>
                <span class="menu-item">Idioma</span>
            </button>
        </div>
        
        <!-- Ferramentas Section -->
        <div class="space-y-2">
            <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider px-3">Ferramentas</p>
            <button onclick="showTextSummary()" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="menu-item">Resumo de Texto</span>
            </button>
            
            <button onclick="showQRGenerator()" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                </svg>
                <span class="menu-item">Gerador de QR Code</span>
            </button>
            
            <button onclick="showPasswordGenerator()" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                </svg>
                <span class="menu-item">Criar Senha Forte</span>
            </button>
        </div>
        
        <!-- Informa√ß√µes Section -->
        <div class="space-y-2">
            <p class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider px-3">Informa√ß√µes</p>
            <button onclick="window.open('https://termos.orpheostudio.com.br', '_blank')" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                <span class="menu-item">Termos de Uso</span>
            </button>
            
            <button onclick="window.open('https://politicas.orpheostudio.com.br', '_blank')" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                </svg>
                <span class="menu-item">Pol√≠ticas de Privacidade</span>
            </button>
            
            <button onclick="reportBug()" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <span class="menu-item">Reportar Bug</span>
            </button>
            
            <button onclick="sendFeedback()" class="w-full flex items-center gap-3 p-3 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-xl transition-colors focus-highlight">
                <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                </svg>
                <span class="menu-item">Enviar Feedback</span>
            </button>
        </div>
        
        <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
            <p class="text-sm text-gray-600 dark:text-gray-400 text-center">
                MiraAI by Orpheo Studio üå∏
            </p>
            <p class="text-xs text-gray-500 dark:text-gray-500 text-center mt-1">
                Vers√£o 3.0
            </p>
        </div>
    </div>
</div>

<!-- Modal de Configura√ß√µes -->
<div id="settingsModal" class="hidden fixed inset-0 z-50 settings-modal flex items-center justify-center p-4">
    <div class="settings-content w-full max-w-md p-6 shadow-xl">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold menu-item">Configura√ß√µes</h3>
            <button onclick="hideSettings()" class="p-2 hover:bg-purple-100 dark:hover:bg-purple-900/30 rounded-lg focus-highlight">
                <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <div class="space-y-6">
            <!-- Tema -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-medium menu-item">Modo Escuro</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Ativar/desativar tema escuro</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="darkModeToggle" onchange="toggleDarkModeFromSettings()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <!-- Idioma -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-medium menu-item">Idioma</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Selecione o idioma da interface</p>
                </div>
                <select id="languageSelect" class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm menu-item focus-highlight">
                    <option value="pt">Portugu√™s</option>
                    <option value="en">English</option>
                    <option value="es">Espa√±ol</option>
                </select>
            </div>
            
            <!-- Voz -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-medium menu-item">Reconhecimento de Voz</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Ativar/desativar entrada por voz</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="voiceToggle" checked onchange="toggleVoiceSetting()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <!-- Hist√≥rico -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-medium menu-item">Salvar Hist√≥rico</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Manter hist√≥rico de conversas</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="historyToggle" checked onchange="toggleHistorySetting()">
                    <span class="toggle-switch"></span>
                </label>
            </div>
            
            <!-- Notifica√ß√µes -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-medium menu-item">Notifica√ß√µes</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Receber notifica√ß√µes de resposta</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="notificationsToggle" onchange="toggleNotificationsSetting()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <!-- Acessibilidade -->
            <div class="flex items-center justify-between">
                <div>
                    <p class="font-medium menu-item">Assistive Touch</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">Menu flutuante de acessibilidade</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="assistiveToggle" checked onchange="toggleAssistiveSetting()">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <!-- Bot√µes de A√ß√£o -->
            <div class="flex gap-3 pt-4">
                <button onclick="exportChat()" class="flex-1 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-4 py-2 rounded-lg text-sm font-medium hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors focus-highlight">
                    Exportar Chat
                </button>
                <button onclick="clearAllData()" class="flex-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors focus-highlight">
                    Limpar Dados
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// ==================== CONFIG ====================

const MISTRAL_API_KEY = 'NFuAj8PYUPcaf6tA1BjbyXuIeSjSA4sW';
const MISTRAL_API_URL = 'https://api.mistral.ai/v1/chat/completions';
const SUPPORT_EMAIL = 'sac.studiotsukiyo@outlook.com';

// ==================== STATE ====================

let currentLanguage = 'pt';
let isDarkMode = false;
let isListening = false;
let recognition = null;
let conversationHistory = [];
let textToSpeechActive = false;
let highContrastMode = false;
let currentFontSize = 1;
let assistiveTouchEnabled = true;
let speechSynthesis = window.speechSynthesis;
let settings = {
    voiceEnabled: true,
    saveHistory: true,
    notifications: false,
    assistiveTouch: true
};

// ==================== NLP R√ÅPIDO ====================

const quickPatterns = {
    pt: {
        greetings: {
            patterns: ['oi', 'ol√°', 'ola', 'bom dia', 'boa tarde', 'boa noite'],
            response: 'Ol√°! üå∏ Como posso ajudar voc√™ hoje?'
        },
        thanks: {
            patterns: ['obrigado', 'obrigada', 'valeu', 'obg'],
            response: 'De nada! üíú Precisa de mais alguma coisa?'
        },
        time: {
            patterns: ['que horas', 'hor√°rio'],
            response: () => `S√£o ${new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'})} ‚è∞`
        }
    }
};

// ==================== INIT ====================

function init() {
    // Carregar configura√ß√µes salvas
    loadSettings();
    
    // Aplicar tema salvo
    const savedTheme = localStorage.getItem('sena-theme');
    if (savedTheme === 'dark') {
        isDarkMode = true;
        document.documentElement.classList.add('dark');
        document.getElementById('darkModeToggle').checked = true;
    }
    
    // Aplicar idioma salvo
    const savedLanguage = localStorage.getItem('sena-language');
    if (savedLanguage) {
        currentLanguage = savedLanguage;
        document.getElementById('languageSelect').value = savedLanguage;
    }
    
    // Aplicar configura√ß√µes de acessibilidade
    const savedFontSize = localStorage.getItem('sena-fontSize');
    if (savedFontSize) {
        currentFontSize = parseFloat(savedFontSize);
        applyFontSize();
    }
    
    const savedHighContrast = localStorage.getItem('sena-highContrast');
    if (savedHighContrast === 'true') {
        highContrastMode = true;
        document.body.classList.add('high-contrast');
    }
    
    const savedAssistiveTouch = localStorage.getItem('sena-assistiveTouch');
    if (savedAssistiveTouch === 'false') {
        assistiveTouchEnabled = false;
        document.getElementById('assistiveTouch').classList.add('hidden');
        document.getElementById('assistiveToggle').checked = false;
    }
    
    document.getElementById('messageForm').addEventListener('submit', handleSubmit);
    
    // Inicializar reconhecimento de voz se habilitado
    if (settings.voiceEnabled && ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
        initVoiceRecognition();
    }
    
    // Atualizar toggles das configura√ß√µes
    updateSettingsToggles();
    
    // Adicionar eventos de teclado para acessibilidade
    setupKeyboardAccessibility();
    
    // Anunciar recursos de acessibilidade para leitores de tela
    announceToScreenReader('Sena carregada. Pressione Tab para navegar ou use o bot√£o de acessibilidade no canto inferior direito.');
}

function loadSettings() {
    const savedSettings = localStorage.getItem('sena-settings');
    if (savedSettings) {
        settings = { ...settings, ...JSON.parse(savedSettings) };
    }
}

function saveSettings() {
    localStorage.setItem('sena-settings', JSON.stringify(settings));
}

function initVoiceRecognition() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    recognition = new SpeechRecognition();
    recognition.lang = currentLanguage === 'pt' ? 'pt-BR' : currentLanguage === 'es' ? 'es-ES' : 'en-US';
    recognition.continuous = false;
    
    recognition.onresult = (e) => {
        document.getElementById('messageInput').value = e.results[0][0].transcript;
        isListening = false;
        updateVoiceUI();
    };
    
    recognition.onend = () => {
        isListening = false;
        updateVoiceUI();
    };
}

function updateSettingsToggles() {
    document.getElementById('voiceToggle').checked = settings.voiceEnabled;
    document.getElementById('historyToggle').checked = settings.saveHistory;
    document.getElementById('notificationsToggle').checked = settings.notifications;
    document.getElementById('assistiveToggle').checked = settings.assistiveTouch;
}

function setupKeyboardAccessibility() {
    document.addEventListener('keydown', (e) => {
        // Atalho para assistive touch (Alt + A)
        if (e.altKey && e.key === 'a') {
            toggleAssistiveMenu();
        }
        
        // Atalho para ler tela (Alt + S)
        if (e.altKey && e.key === 's') {
            toggleTextToSpeech();
        }
        
        // Atalho para aumentar texto (Alt + +)
        if (e.altKey && e.key === '+') {
            increaseFontSize();
        }
        
        // Atalho para diminuir texto (Alt + -)
        if (e.altKey && e.key === '-') {
            decreaseFontSize();
        }
        
        // Atalho para alto contraste (Alt + C)
        if (e.altKey && e.key === 'c') {
            toggleHighContrast();
        }
    });
}

// ==================== ASSISTIVE TOUCH ====================

function toggleAssistiveMenu() {
    const menu = document.getElementById('assistiveMenu');
    const button = document.getElementById('assistiveTouch');
    
    menu.classList.toggle('active');
    button.classList.toggle('active');
    
    if (menu.classList.contains('active')) {
        announceToScreenReader('Menu de acessibilidade aberto. Use Tab para navegar pelas op√ß√µes.');
    } else {
        announceToScreenReader('Menu de acessibilidade fechado.');
    }
}

function toggleAssistiveSetting() {
    settings.assistiveTouch = !settings.assistiveTouch;
    saveSettings();
    
    const assistiveTouch = document.getElementById('assistiveTouch');
    if (settings.assistiveTouch) {
        assistiveTouch.classList.remove('hidden');
        announceToScreenReader('Assistive touch ativado.');
    } else {
        assistiveTouch.classList.add('hidden');
        document.getElementById('assistiveMenu').classList.remove('active');
        announceToScreenReader('Assistive touch desativado.');
    }
}

// ==================== TEXT TO SPEECH ====================

function toggleTextToSpeech() {
    textToSpeechActive = !textToSpeechActive;
    
    if (textToSpeechActive) {
        document.body.classList.add('text-to-speech-active');
        speakText('Modo leitura de tela ativado. Vou ler em voz alta os elementos da tela.');
        announceToScreenReader('Modo leitura de tela ativado. Clique em qualquer elemento para ouvir sua descri√ß√£o.');
        showVoiceFeedback('Leitura de tela ativada üîä');
    } else {
        document.body.classList.remove('text-to-speech-active');
        speechSynthesis.cancel();
        speakText('Modo leitura de tela desativado.');
        announceToScreenReader('Modo leitura de tela desativado.');
        showVoiceFeedback('Leitura de tela desativada üîá');
    }
    
    // Adicionar eventos de clique para leitura de elementos
    if (textToSpeechActive) {
        document.addEventListener('click', handleElementClickForTTS);
    } else {
        document.removeEventListener('click', handleElementClickForTTS);
    }
}

function handleElementClickForTTS(event) {
    const element = event.target;
    let textToSpeak = '';
    
    if (element.textContent && element.textContent.trim()) {
        textToSpeak = element.textContent.trim();
    } else if (element.alt) {
        textToSpeak = element.alt;
    } else if (element.placeholder) {
        textToSpeak = `Campo: ${element.placeholder}`;
    } else if (element.title) {
        textToSpeak = element.title;
    }
    
    if (textToSpeak) {
        speakText(textToSpeak);
    }
}

function speakText(text) {
    if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
    }
    
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = currentLanguage === 'pt' ? 'pt-BR' : currentLanguage === 'es' ? 'es-ES' : 'en-US';
    utterance.rate = 0.9;
    utterance.pitch = 1;
    utterance.volume = 1;
    
    speechSynthesis.speak(utterance);
}

function speakCurrentTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('pt-BR', { 
        hour: '2-digit', 
        minute: '2-digit' 
    });
    const message = `Agora s√£o ${timeString}`;
    speakText(message);
    showVoiceFeedback(`Hor√°rio: ${timeString}`);
    toggleAssistiveMenu();
}

function speakHelp() {
    const helpText = `
        Bem-vindo ao modo de acessibilidade da Sena. 
        Use o bot√£o Ler Tela para ativar a leitura de elementos. 
        Use Aumentar Texto e Diminuir Texto para ajustar o tamanho da fonte.
        Use Alto Contraste para melhor visibilidade.
        Pressione Alt mais A para abrir este menu.
        Pressione Alt mais S para ativar leitura de tela.
        Pressione Alt mais mais para aumentar o texto.
        Pressione Alt mais menos para diminuir o texto.
        Pressione Alt mais C para alto contraste.
    `;
    speakText(helpText);
    toggleAssistiveMenu();
}

// ==================== VISUAL ACCESSIBILITY ====================

function increaseFontSize() {
    if (currentFontSize < 1.5) {
        currentFontSize += 0.1;
        applyFontSize();
        localStorage.setItem('sena-fontSize', currentFontSize.toString());
        showVoiceFeedback(`Texto aumentado para ${Math.round(currentFontSize * 100)}%`);
    } else {
        showVoiceFeedback('Tamanho m√°ximo atingido');
    }
    toggleAssistiveMenu();
}

function decreaseFontSize() {
    if (currentFontSize > 0.8) {
        currentFontSize -= 0.1;
        applyFontSize();
        localStorage.setItem('sena-fontSize', currentFontSize.toString());
        showVoiceFeedback(`Texto diminu√≠do para ${Math.round(currentFontSize * 100)}%`);
    } else {
        showVoiceFeedback('Tamanho m√≠nimo atingido');
    }
    toggleAssistiveMenu();
}

function applyFontSize() {
    document.body.style.fontSize = `${currentFontSize}em`;
}

function toggleHighContrast() {
    highContrastMode = !highContrastMode;
    document.body.classList.toggle('high-contrast');
    
    if (highContrastMode) {
        localStorage.setItem('sena-highContrast', 'true');
        speakText('Modo alto contraste ativado');
        showVoiceFeedback('Alto contraste ativado üåì');
    } else {
        localStorage.setItem('sena-highContrast', 'false');
        speakText('Modo alto contraste desativado');
        showVoiceFeedback('Alto contraste desativado üåó');
    }
    toggleAssistiveMenu();
}

// ==================== EMERGENCY FEATURES ====================

function emergencyCall() {
    if (confirm('Deseja ligar para emerg√™ncia? (192 - SAMU)')) {
        speakText('Ligando para o servi√ßo de emerg√™ncia. Por favor, aguarde.');
        showVoiceFeedback('Ligando para emerg√™ncia... üö®');
        
        // Simular liga√ß√£o (em produ√ß√£o, isso usaria a API de telefonia)
        setTimeout(() => {
            speakText('Conectando com o servi√ßo de emerg√™ncia. Por favor, descreva sua situa√ß√£o.');
            showVoiceFeedback('Conectado com emerg√™ncia');
        }, 3000);
    }
    toggleAssistiveMenu();
}

// ==================== SCREEN READER SUPPORT ====================

function announceToScreenReader(message) {
    const announcement = document.getElementById('screenReaderAnnouncement');
    announcement.textContent = message;
    
    // For√ßar leitura para leitores de tela
    setTimeout(() => {
        announcement.textContent = '';
    }, 100);
}

function showVoiceFeedback(message) {
    const feedback = document.getElementById('voiceFeedback');
    feedback.textContent = message;
    feedback.classList.remove('hidden');
    
    setTimeout(() => {
        feedback.classList.add('hidden');
    }, 3000);
}

// ==================== UI ====================

function startChat() {
    document.getElementById('splashScreen').classList.add('hidden');
    document.getElementById('chatInterface').classList.remove('hidden');
    
    addMessage('bot', 'Ol√°! Sou a Sena üå∏\n\nComo posso ajudar voc√™ hoje?');
    showSuggestions();
    
    announceToScreenReader('Chat iniciado. Digite sua mensagem ou use os bot√µes de sugest√£o.');
}

function showSuggestions() {
    const container = document.getElementById('messagesContainer');
    const suggestionsDiv = document.createElement('div');
    suggestionsDiv.className = 'flex flex-wrap gap-2 justify-center my-4';
    suggestionsDiv.innerHTML = `
        <button onclick="selectSuggestion('O que voc√™ pode fazer?')" class="suggestion-btn px-4 py-2 rounded-full text-sm hover:scale-105 transition-transform focus-highlight">
            O que voc√™ pode fazer?
        </button>
        <button onclick="selectSuggestion('Me recomende um anime')" class="suggestion-btn px-4 py-2 rounded-full text-sm hover:scale-105 transition-transform focus-highlight">
            Me recomende um anime
        </button>
        <button onclick="selectSuggestion('Como funciona o 5G?')" class="suggestion-btn px-4 py-2 rounded-full text-sm hover:scale-105 transition-transform focus-highlight">
            Como funciona o 5G?
        </button>
    `;
    container.appendChild(suggestionsDiv);
}

function selectSuggestion(text) {
    document.getElementById('messageInput').value = text;
    handleSubmit(new Event('submit'));
}

function showMenu() {
    document.getElementById('sideMenu').classList.remove('hidden');
    announceToScreenReader('Menu lateral aberto. Use Tab para navegar.');
}

function hideMenu() {
    document.getElementById('sideMenu').classList.add('hidden');
    announceToScreenReader('Menu lateral fechado.');
}

function showSettings() {
    document.getElementById('settingsModal').classList.remove('hidden');
    announceToScreenReader('Configura√ß√µes abertas. Use Tab para navegar.');
}

function hideSettings() {
    document.getElementById('settingsModal').classList.add('hidden');
    announceToScreenReader('Configura√ß√µes fechadas.');
}

function toggleDarkMode() {
    isDarkMode = !isDarkMode;
    document.documentElement.classList.toggle('dark');
    localStorage.setItem('sena-theme', isDarkMode ? 'dark' : 'light');
    
    if (isDarkMode) {
        speakText('Modo escuro ativado');
    } else {
        speakText('Modo claro ativado');
    }
}

function toggleDarkModeFromSettings() {
    toggleDarkMode();
    document.getElementById('darkModeToggle').checked = isDarkMode;
}

// ==================== CHAT ====================

function handleSubmit(e) {
    e.preventDefault();
    const input = document.getElementById('messageInput');
    const message = input.value.trim();
    
    if (!message) return;
    
    input.value = '';
    addMessage('user', message);
    conversationHistory.push({ role: 'user', content: message });
    
    const quickResponse = getQuickResponse(message);
    
    if (quickResponse) {
        setTimeout(() => addMessage('bot', quickResponse), 300);
    } else {
        sendToMistral(message);
    }
}

function getQuickResponse(message) {
    const msg = message.toLowerCase();
    const patterns = quickPatterns[currentLanguage];
    
    for (const pattern of Object.values(patterns)) {
        if (pattern.patterns.some(p => msg.includes(p))) {
            return typeof pattern.response === 'function' ? pattern.response() : pattern.response;
        }
    }
    return null;
}

async function sendToMistral(message) {
    showTyping();
    
    try {
        const response = await fetch(MISTRAL_API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${MISTRAL_API_KEY}`
            },
            body: JSON.stringify({
                model: 'mistral-large-latest',
                messages: [
                    {
                        role: 'system',
                        content: 'Voc√™ √© a Sena, assistente gentil da Orpheo Studio. Seja natural, direta e use emojis moderadamente. Respostas curtas (m√°x 3 frases). NUNCA mencione "como IA", "processamento" ou termos t√©cnicos.'
                    },
                    ...conversationHistory.slice(-6)
                ],
                temperature: 0.7,
                max_tokens: 400
            })
        });
        
        const data = await response.json();
        let reply = data.choices[0].message.content;
        reply = cleanResponse(reply);
        
        hideTyping();
        addMessage('bot', reply);
        conversationHistory.push({ role: 'assistant', content: reply });
        
        // Ler resposta automaticamente se TTS estiver ativo
        if (textToSpeechActive) {
            setTimeout(() => speakText(reply), 500);
        }
        
    } catch (error) {
        hideTyping();
        addMessage('bot', 'Desculpe, tive um problema. Pode tentar novamente? üòî');
    }
}

function cleanResponse(text) {
    const patterns = [
        /como (uma |um )?assistente/gi,
        /\*+[^*]*\*+/g,
        /meu sistema/gi,
        /processando/gi
    ];
    
    let cleaned = text;
    patterns.forEach(p => cleaned = cleaned.replace(p, ''));
    return cleaned.replace(/\s+/g, ' ').trim();
}

function addMessage(role, text) {
    const container = document.getElementById('messagesContainer');
    const div = document.createElement('div');
    div.className = `chat-bubble flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
    
    div.innerHTML = `
        <div class="${role === 'user' ? 'message-user' : 'message-bot'} px-4 py-3 shadow-md focus-highlight" tabindex="0">
            <p class="text-sm leading-relaxed whitespace-pre-wrap">${text}</p>
        </div>
    `;
    
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
}

function showTyping() {
    const container = document.getElementById('messagesContainer');
    const div = document.createElement('div');
    div.id = 'typingIndicator';
    div.className = 'chat-bubble flex justify-start';
    div.innerHTML = `
        <div class="message-bot typing-indicator">
            <span></span>
            <span></span>
            <span></span>
        </div>
    `;
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
}

function hideTyping() {
    document.getElementById('typingIndicator')?.remove();
}

function clearChat() {
    if (confirm('Limpar conversa?')) {
        conversationHistory = [];
        document.getElementById('messagesContainer').innerHTML = '';
        addMessage('bot', 'Ol√°! Sou a Sena üå∏\n\nComo posso ajudar voc√™ hoje?');
        showSuggestions();
        hideMenu();
    }
}

// ==================== VOZ ====================

function toggleVoice() {
    if (!settings.voiceEnabled) {
        alert('Reconhecimento de voz est√° desativado nas configura√ß√µes.');
        return;
    }
    
    if (!recognition) {
        alert('Seu navegador n√£o suporta voz ou o reconhecimento n√£o foi inicializado.');
        return;
    }
    
    if (isListening) {
        recognition.stop();
    } else {
        recognition.start();
        isListening = true;
        updateVoiceUI();
    }
}

function updateVoiceUI() {
    const indicator = document.getElementById('voiceIndicator');
    const micIcon = document.getElementById('micIcon');
    
    if (isListening) {
        indicator.classList.remove('hidden');
        micIcon.classList.add('text-pink-500');
    } else {
        indicator.classList.add('hidden');
        micIcon.classList.remove('text-pink-500');
    }
}

function toggleVoiceSetting() {
    settings.voiceEnabled = !settings.voiceEnabled;
    saveSettings();
    
    if (settings.voiceEnabled && !recognition) {
        initVoiceRecognition();
    }
}

// ==================== CONFIGURA√á√ïES ====================

function changeLanguage() {
    const newLanguage = document.getElementById('languageSelect').value;
    currentLanguage = newLanguage;
    localStorage.setItem('sena-language', newLanguage);
    
    if (recognition) {
        recognition.lang = newLanguage === 'pt' ? 'pt-BR' : newLanguage === 'es' ? 'es-ES' : 'en-US';
    }
    
    alert(`Idioma alterado para ${getLanguageName(newLanguage)} üåç`);
    hideMenu();
}

function getLanguageName(code) {
    const languages = {
        'pt': 'Portugu√™s',
        'en': 'English',
        'es': 'Espa√±ol'
    };
    return languages[code] || code;
}

function toggleHistorySetting() {
    settings.saveHistory = !settings.saveHistory;
    saveSettings();
    
    if (!settings.saveHistory) {
        conversationHistory = [];
    }
}

function toggleNotificationsSetting() {
    settings.notifications = !settings.notifications;
    saveSettings();
    
    if (settings.notifications && 'Notification' in window) {
        Notification.requestPermission();
    }
}

function exportChat() {
    const chatContent = conversationHistory.map(msg => 
        `${msg.role === 'user' ? 'Voc√™' : 'Sena'}: ${msg.content}`
    ).join('\n\n');
    
    const blob = new Blob([chatContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `chat-sena-${new Date().toISOString().split('T')[0]}.txt`;
    a.click();
    URL.revokeObjectURL(url);
    
    alert('Chat exportado com sucesso! üìÑ');
}

function clearAllData() {
    if (confirm('Tem certeza que deseja limpar todos os dados? Isso inclui hist√≥rico de conversas e configura√ß√µes.')) {
        localStorage.clear();
        conversationHistory = [];
        settings = {
            voiceEnabled: true,
            saveHistory: true,
            notifications: false,
            assistiveTouch: true
        };
        currentFontSize = 1;
        highContrastMode = false;
        applyFontSize();
        document.body.classList.remove('high-contrast');
        updateSettingsToggles();
        alert('Todos os dados foram limpos! üîÑ');
        hideSettings();
    }
}

// ==================== FEEDBACK E BUGS ====================

function reportBug() {
    const subject = encodeURIComponent('[SENA] Reportar Bug');
    const body = encodeURIComponent(`\n\n---\nData: ${new Date().toLocaleString()}\nNavegador: ${navigator.userAgent}\nVers√£o: 3.0`);
    window.open(`mailto:${SUPPORT_EMAIL}?subject=${subject}&body=${body}`);
    hideMenu();
}

function sendFeedback() {
    const subject = encodeURIComponent('[SENA] Feedback');
    const body = encodeURIComponent(`\n\n---\nData: ${new Date().toLocaleString()}\nVers√£o: 3.0`);
    window.open(`mailto:${SUPPORT_EMAIL}?subject=${subject}&body=${body}`);
    hideMenu();
}

// ==================== FERRAMENTAS ====================

function showTextSummary() {
    hideMenu();
    const text = prompt('üìù Cole o texto que deseja resumir:');
    
    if (text && text.trim()) {
        addMessage('user', 'Resuma este texto:\n\n' + text.substring(0, 200) + '...');
        conversationHistory.push({ 
            role: 'user', 
            content: `Fa√ßa um resumo curto e objetivo deste texto em portugu√™s: ${text}` 
        });
        sendToMistral(`Fa√ßa um resumo curto e objetivo deste texto em portugu√™s: ${text}`);
    }
}

function showQRGenerator() {
    hideMenu();
    const url = prompt('üîó Digite o link ou texto para gerar QR Code:');
    
    if (url && url.trim()) {
        const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(url)}`;
        
        addMessage('user', 'Gerar QR Code para: ' + url);
        
        setTimeout(() => {
            const container = document.getElementById('messagesContainer');
            const div = document.createElement('div');
            div.className = 'chat-bubble flex justify-start';
            div.innerHTML = `
                <div class="message-bot px-4 py-3 shadow-md">
                    <p class="text-sm mb-3">Aqui est√° seu QR Code! üì±</p>
                    <img src="${qrApiUrl}" alt="QR Code" class="rounded-xl shadow-lg mx-auto" style="max-width: 300px;">
                    <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">Escaneie com a c√¢mera do celular</p>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }, 500);
    }
}

function showPasswordGenerator() {
    hideMenu();
    
    const length = 16;
    const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?';
    let password = '';
    
    for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
    }
    
    addMessage('user', 'Gerar senha forte');
    
    setTimeout(() => {
        const container = document.getElementById('messagesContainer');
        const div = document.createElement('div');
        div.className = 'chat-bubble flex justify-start';
        div.innerHTML = `
            <div class="message-bot px-4 py-3 shadow-md">
                <p class="text-sm mb-3">Sua senha forte foi gerada! üîê</p>
                <div class="bg-gray-100 dark:bg-gray-800 rounded-lg p-3 font-mono text-center">
                    <span class="text-purple-600 dark:text-purple-400 font-semibold text-lg">${password}</span>
                </div>
                <p class="text-xs text-gray-500 dark:text-gray-400 mt-3">‚úì 16 caracteres</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">‚úì Letras mai√∫sculas e min√∫sculas</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">‚úì N√∫meros e s√≠mbolos especiais</p>
                <button onclick="copyToClipboard('${password}')" class="mt-3 w-full bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-4 py-2 rounded-lg text-sm font-medium hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors focus-highlight">
                    Copiar Senha
                </button>
            </div>
        `;
        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
    }, 500);
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        alert('‚úÖ Senha copiada para a √°rea de transfer√™ncia!');
    }).catch(() => {
        alert('‚ùå Erro ao copiar. Tente selecionar e copiar manualmente.');
    });
}

// ==================== START ====================

document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>